<!-- build time:Fri Apr 23 2021 17:18:44 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="专注技术分享" href="http://yrmlnf.coding-pages.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="专注技术分享" href="http://yrmlnf.coding-pages.com/atom.xml"><link rel="alternate" type="application/json" title="专注技术分享" href="http://yrmlnf.coding-pages.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="druid"><link rel="canonical" href="http://yrmlnf.coding-pages.com/Druid-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E4%BD%BF%E7%94%A8/"><title>Druid-基本概念与使用 - 大数据 - 计算机科学 | Lucas Home = 专注技术分享 = 醒醒，别做梦了</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Druid-基本概念与使用</h1><div class="meta"><span class="item" title="创建时间：2021-03-31 10:58:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-03-31T10:58:00+08:00">2021-03-31</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>20k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>18 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Lucas Home</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/005yAHGDly8gplguudf0nj31hc0u0n7b.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/005yAHGDly8gplguyta0ij31hc0u07d4.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/005yAHGDly8gplgunan8tj31cv0q9tcp.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/005yAHGDly8gplgts3yd7j31hc0u043f.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/005yAHGDly8gplgtpzw5vj30x40imtab.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/005yAHGDly8gplgumdumoj31hc0u0468.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="item" rel="index" title="分类于 大数据"><span itemprop="name">大数据</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://yrmlnf.coding-pages.com/Druid-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E4%BD%BF%E7%94%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Lucas"><meta itemprop="description" content="醒醒，别做梦了, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="专注技术分享"></span><div class="body md" itemprop="articleBody"><h1 id="什么是druid"><a class="anchor" href="#什么是druid">#</a> 什么是 DRUID</h1><p>​ <span class="exturl" data-url="aHR0cHM6Ly9kcnVpZC5hcGFjaGUub3JnLw==">Druid</span> 是一个高效的数据查询系统，主要解决的是对于大量的基于时序的数据进行聚合查询。数据可以实时摄入，进入到 Druid 后立即可查，同时数据是几乎是不可变。通常是基于时序的事实事件，事实发生后进入 Druid，外部系统就可以对该事实进行查询</p><h1 id="druid的技术特点"><a class="anchor" href="#druid的技术特点">#</a> Druid 的技术特点</h1><ul><li><p>数据吞吐量大</p></li><li><p>支持流式数据摄入和实时</p></li><li><p>查询灵活且快速</p></li></ul><h1 id="druid总体架构"><a class="anchor" href="#druid总体架构">#</a> Druid 总体架构</h1><blockquote><p>本身包含了五种节点 ： Realtime、Historical、Coordinator、Broker、Indexer</p></blockquote><h2 id="historical历史节点"><a class="anchor" href="#historical历史节点">#</a> Historical（历史节点)</h2><blockquote><p>历史节点主要负责加载已经生成好的数据文件以及提供数据查询。</p></blockquote><p>​ 历史节点启动时，会先检查自身的本地缓存中已存在的 Segment 数据文件，然后从 DeepStorage 中下载数据自己但不在本地的 Segment 数据文件，后加载到内存后再提供查询。</p><h2 id="realtime-实时节点"><a class="anchor" href="#realtime-实时节点">#</a> Realtime （实时节点）</h2><blockquote><p>主要负责及时摄入实时数据，以及生成 Segment 数据文件；</p></blockquote><p>​ Realtime 节点只响应 broker 节点的查询请求，返回查询结果到 broker 节点。旧数据会按指定周期将数据 build 成 segments 移到 Historical 节点。一般会使用外部依赖 kafka 来提高实时摄取数据的可用性。如果不需要实时摄取数据到集群中，可以舍弃 Real-time nodes，只定时地批量从 deep storage 摄取数据即可；</p><h3 id="segment数据文件的制造与传播"><a class="anchor" href="#segment数据文件的制造与传播">#</a> Segment 数据文件的制造与传播</h3><ul><li>实时节点生成 Segment 数据文件，并上传到 DeepStorage 中。</li><li>Segment 数据文件的相关元数据信息保存到 MetaStore 中（mysql)</li><li>协调节点会从 MetaSotre 中获取到 Segment 数据文件的相关元信息后，将按配置的规则分配到符合条件的历史节点中。</li><li>历史节点收到协调节点的通知后，会从 DeepStorage 中拉取该 Segment 数据文件，并通过 zookeeper 向集群声明可以提供查询了。</li><li>实时节点会丢弃该 Segment 数据文件，并通过 zookeeper 向集群声明不在提供该 Sgment 的查询服务。</li></ul><h2 id="coordinator-协调节点"><a class="anchor" href="#coordinator-协调节点">#</a> Coordinator (协调节点)</h2><blockquote><p>协调节点主要负责历史节点的数据负载均衡，以及通过规则管理数据源的生命周期。</p></blockquote><p>​ 监控 historical 节点组，可以认为是 Druid 中的 master，其通过 Zookeeper 管理 Historical 和 Real-time nodes，且通过 Mysql 中的 metadata 管理 Segments，以确保数据可用、可复制。它们通过从 MySQL 读取数据段的元数据信息，来决定哪些数据段应该在集群中被加载，使用 Zookeeper 来确定哪个 historical 节点存在，并且创建 Zookeeper 条目告诉 historical 节点加载和删除新数据段。</p><h2 id="broker-查询节点"><a class="anchor" href="#broker-查询节点">#</a> Broker （查询节点）</h2><blockquote><p>对外提供数据查询服务，并同时从实施节点、历史节点查询数据，合并后返给调用方</p></blockquote><p>​ Druid 集群直接对外提供查询的节点只有查询节点，而查询节点会将从实时节点与历史节点查询到的数据进行合并并返回。</p><h2 id="indexer-索引节点"><a class="anchor" href="#indexer-索引节点">#</a> Indexer（ 索引节点）</h2><blockquote><p>索引服务用于数据导入，batch data 和 streaming data 都可以通过给 indexing services 发请求来导入数据 Indexing service 可以通过 api 的方式灵活的操作 Segment 文件，如合并，删除 Segment 等</p></blockquote><p>​ Indexing service 主要由三个组件构成，一个 peon 运行一个任务，一个 middle manager 负责管理多个 peon，overlord 负责接收新的任务分配给 middle manager，overlord 和 middle manager 可以运行在同一节点或跨多个节点，而 middle manager 和 peon 一般运行在同一个节点</p><h3 id="middlemanager"><a class="anchor" href="#middlemanager">#</a> MiddleManager</h3><blockquote><p>将新数据摄取到集群中。负责从外部数据源读取数据并发布新的 Druid segments。</p></blockquote><h3 id="overlord"><a class="anchor" href="#overlord">#</a> Overlord</h3><blockquote><p>监视 MiddleManager 进程，并且是数据摄入 Druid 的控制器。它们负责将提取任务分配给 MiddleManagers 并协调 segment 发布</p></blockquote><h2 id="router可选"><a class="anchor" href="#router可选">#</a> Router (可选)</h2><blockquote><p>​ Router 进程是一个可选的进程，他为 Broker、Overload 和 Coordinator 提供了统一 API 网管服务。如果不启动该进程，也可以直接连接 Broker、Overload 和 Coordinator 服务</p></blockquote><h2 id="外部依赖"><a class="anchor" href="#外部依赖">#</a> 外部依赖</h2><ul><li><strong>Mysql</strong>：用于存储关于 Druid 中的 metadata，规则数据，配置数据等</li><li><strong>Deep storage</strong> ：储 segments，Druid 目前已经支持本地磁盘，NFS 挂载磁盘，HDFS，S3 等。数据来源有 2 个批处理和 Realtime 节点</li><li><strong>ZooKeeper</strong>：于管理当前 cluster 的状态为集群服务发现和维持当前的数据拓扑而服务；被 Druid 用于管理当前 cluster 的状态，比如记录哪些 segments 从实时节点移到了历史节点；</li></ul><h2 id="安装节点"><a class="anchor" href="#安装节点">#</a> 安装节点</h2><table><thead><tr><th>Node</th><th>IP</th></tr></thead><tbody><tr><td><strong>Coordinator</strong></td><td>hdp-m-1 ,hip-m-2,</td></tr><tr><td><strong>Broker</strong></td><td>hdp-m-1,hdp-m-2</td></tr><tr><td><strong>MiddleManager</strong></td><td>hdp-m-1,hdp-m-2</td></tr><tr><td><strong>Overlord</strong></td><td>hdp-m-1,hdp-m-2</td></tr><tr><td><strong>Router</strong></td><td>hdp-m-1,hdp-m-2</td></tr><tr><td><strong>Historical</strong></td><td>hdp-s-1,hdp-s-2,hdp-s-3</td></tr></tbody></table><h1 id="druid基本概念"><a class="anchor" href="#druid基本概念">#</a> Druid 基本概念</h1><h2 id="datasource结构"><a class="anchor" href="#datasource结构">#</a> DataSource 结构</h2><blockquote><p>Druid 在数据摄入之前，首先要定义一个数据源（DataSource, 类似于数据库中表的概念）<br>Druid 是一个分布式数据分析平台，也是一个时序数据库</p></blockquote><p>与传统关系型数据库相比，Druid 的 DataSource 可以算是 table，DataSource 的结构包括以下几个方面</p><ul><li><strong>时间列</strong>（TimeStamp）：表明每行数据的时间值，默认只用 UTC 时间格式且精确到毫秒。这个列是数据聚合与范围查询的重要维度</li><li><strong>维度列</strong>（Dimension）：用来表示数据行的各个类别信息</li><li><strong>指标列</strong>（Metric）：用于聚合和计算的列</li></ul><h2 id="segment结构"><a class="anchor" href="#segment结构">#</a> Segment 结构</h2><blockquote><p>DataSource 是逻辑结构，而 Segment 是数据实际存储的物理结构，Druid 通过 Segment 实现对数据的横纵切割操作。</p></blockquote><ul><li><strong>横向切割</strong>：通过设置在 segmentGranularity 参数，Druid 将不同时间范围内的数据存储在不同 Segment 数据块中。</li><li><strong>纵向切割</strong>：在 Segment 中面向列进行数据压缩处理</li></ul><h2 id="数据格式定义"><a class="anchor" href="#数据格式定义">#</a> 数据格式定义</h2><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token property">"dataSchema"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>...<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> #JSON对象，指明数据源格式、数据解析、维度等信息</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token property">"ioConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>...<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> #JSON对象，指明数据如何在Druid中存储</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token property">"tuningConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>...<span class="token punctuation">&#125;</span> #JSON对象，指明存储优化配置（非必填）</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>DataSchema 详解</strong></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token property">"datasource"</span><span class="token operator">:</span><span class="token string">"..."</span><span class="token punctuation">,</span> #string类型，数据源名称</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token property">"parser"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"type"</span><span class="token operator">:</span> &lt;><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"parseSpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token property">"format"</span><span class="token operator">:</span> &lt;><span class="token punctuation">,</span> #数据格式，可以是 “json”<span class="token punctuation">,</span> “jsonLowercase”<span class="token punctuation">,</span> “csv”<span class="token punctuation">,</span> “tsv” 几种格式</pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token property">"timestampSpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>#时间戳和时间戳类型	字段名自动换成__time</pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token property">"dimensionsSpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>#数据的维度（包含哪些列）	</pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> #JSON对象，包含了如何即系数据的相关内容</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token property">"metricsSpec"</span><span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">]</span><span class="token punctuation">,</span> #list 包含了所有的指标信息</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token property">"granularitySpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>...<span class="token punctuation">&#125;</span> #JSON对象，指明数据的存储和查询力度</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>granularitySpec 详解</strong></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token property">"granularitySpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"uniform"</span><span class="token punctuation">,</span> <span class="token comment">//type : 用来指定粒度的类型使用　uniform, arbitrary (尝试创建大小相等的段).</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token property">"segmentGranularity"</span> <span class="token operator">:</span> <span class="token string">"day"</span><span class="token punctuation">,</span> <span class="token comment">//segmentGranularity : 用来确定每个 segment 包含的时间戳范围</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token property">"queryGranularity"</span> <span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span> <span class="token comment">// 控制注入数据的粒度。 最小的 queryGranularity 是 millisecond (毫秒级)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token property">"rollup"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token property">"intervals"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"2018-01-09/2018-01-13"</span><span class="token punctuation">]</span> <span class="token comment">//intervals : 用来确定总的要获取的文件时间戳的范围</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="数据摄入"><a class="anchor" href="#数据摄入">#</a> 数据摄入</h1><h2 id="批处理数据摄入"><a class="anchor" href="#批处理数据摄入">#</a> 批处理数据摄入</h2><p><strong>准备 json 文件 Pageviews.json</strong></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span><span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">"2015-09-01T00:00:00Z"</span><span class="token punctuation">,</span> <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"/foo/bar"</span><span class="token punctuation">,</span> <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"alice"</span><span class="token punctuation">,</span> <span class="token property">"latencyMs"</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span><span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">"2015-09-01T01:00:00Z"</span><span class="token punctuation">,</span> <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"bob"</span><span class="token punctuation">,</span> <span class="token property">"latencyMs"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span><span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">"2015-09-01T01:30:00Z"</span><span class="token punctuation">,</span> <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"/foo/bar"</span><span class="token punctuation">,</span> <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"bob"</span><span class="token punctuation">,</span> <span class="token property">"latencyMs"</span><span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>...</pre></td></tr></table></figure><h3 id="本地文件摄入"><a class="anchor" href="#本地文件摄入">#</a> 本地文件摄入</h3><ul><li><p><strong>准备 pageviews_index_local_json_task.json</strong></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"spec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"ioConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token property">"firehose"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"local"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"baseDir"</span><span class="token operator">:</span><span class="token string">"/usr/hdp/3.1.0.0-78/druid/quickstart/mydemo"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"filter"</span> <span class="token operator">:</span> <span class="token string">"pageviews2.json"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"dataSchema"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token property">"dataSource"</span> <span class="token operator">:</span> <span class="token string">"pageviews"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token property">"granularitySpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"uniform"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"segmentGranularity"</span><span class="token operator">:</span> <span class="token string">"day"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token property">"queryGranularity"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token property">"rollup"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"2015-09-01/2015-09-02"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token property">"parser"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"String"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token property">"parseSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>          <span class="token property">"format"</span> <span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>          <span class="token property">"dimensionsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token property">"dimensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="27"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>          <span class="token property">"timestampSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token property">"format"</span> <span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token property">"column"</span> <span class="token operator">:</span> <span class="token string">"time"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token property">"metricsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="35"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"count"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"count"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token property">"tuningConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token property">"partitionsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"hashed"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token property">"targetPartitionSize"</span> <span class="token operator">:</span> <span class="token number">5000000</span></pre></td></tr><tr><td data-num="46"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token property">"jobProperties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>向 overlord 节点在提交任务（发送 post 请求）</strong></p></li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> -X <span class="token string">'POST'</span> -H <span class="token string">'Content-Type:application/json'</span> -d @pageviews_index_local_json_task.json hdp-m-2.data.dc.zjft.com:8090/druid/indexer/v1/task</pre></td></tr></table></figure><ul><li><strong><span class="exturl" data-url="aHR0cDovL3huLS1kcnVpZGhkcC1tLTItbGsyOWEyODhmcDZoZHVlLmRhdGEuZGMuempmdC5jb206ODA4MQ==">访问 druid 首页 hdp-m-2.data.dc.zjft.com:8081</span></strong></li></ul><p><img data-src="https://upload.cc/i1/2020/01/13/hAOkSp.png" alt="image-20200113093222493"></p><h3 id="hadoop-文件摄入"><a class="anchor" href="#hadoop-文件摄入">#</a> hadoop 文件摄入</h3><ul><li><p><strong>将文件 pageviews.json 上传至 hdfs</strong></p></li><li><p><strong>pageviews_index_hdfs_json_task.json</strong></p></li></ul><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre>cp pageviews_index_local_json_task.json  pageviews_index_hdfs_json_task.json</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre># 将**pageviews_index_hdfs_json_task.json 中ioConfig替换为</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token property">"ioConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"hadoop"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token property">"inputSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"static"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"paths"</span> <span class="token operator">:</span> <span class="token string">"hdfs://zijin-datalake:8020/user/druid/quickstart/pageviews.json"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li><strong>向 overlord 节点在提交任务（发送 post 请求）</strong></li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> -X <span class="token string">'POST'</span> -H <span class="token string">'Content-Type:application/json'</span> -d @pageviews_index_local_json_task.json hdp-m-2.data.dc.zjft.com:8090/druid/indexer/v1/task</pre></td></tr></table></figure><h3 id="csv文件导入"><a class="anchor" href="#csv文件导入">#</a> CSV 文件导入</h3><blockquote><p>只需要改 &quot;parseSpec&quot; 部分</p><p>​ tyep=“csv”</p><p>​	columns 字段必须和 csv 数据的字段一一对应</p><p>​ &quot;columns&quot; : [&quot;time&quot;,&quot;url&quot;,&quot;user&quot;,&quot;latencyMs&quot;],</p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"spec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"ioConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token property">"firehose"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"local"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"baseDir"</span><span class="token operator">:</span><span class="token string">"/usr/hdp/3.1.0.0-78/druid/quickstart/mydemo"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"filter"</span> <span class="token operator">:</span> <span class="token string">"pageviews.csv,pageviews1.csv"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"dataSchema"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token property">"dataSource"</span> <span class="token operator">:</span> <span class="token string">"pageviews2"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token property">"granularitySpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"uniform"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"segmentGranularity"</span><span class="token operator">:</span> <span class="token string">"day"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token property">"queryGranularity"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"2015-09-01/2015-09-02"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token property">"parser"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"String"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token property">"parseSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>          <span class="token property">"format"</span> <span class="token operator">:</span> <span class="token string">"csv"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	  <span class="token property">"columns"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"time"</span><span class="token punctuation">,</span><span class="token string">"url"</span><span class="token punctuation">,</span><span class="token string">"user"</span><span class="token punctuation">,</span><span class="token string">"latencyMs"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>          <span class="token property">"dimensionsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token property">"dimensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="27"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>          <span class="token property">"timestampSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token property">"format"</span> <span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token property">"column"</span> <span class="token operator">:</span> <span class="token string">"time"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token property">"metricsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="35"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"count"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"count"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"latencyMs"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"doubleSum"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token property">"fieldName"</span><span class="token operator">:</span> <span class="token string">"latencyMs"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>      <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token property">"tuningConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>      <span class="token property">"partitionsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"hashed"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token property">"targetPartitionSize"</span> <span class="token operator">:</span> <span class="token number">5000000</span></pre></td></tr><tr><td data-num="51"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token property">"jobProperties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="实时数据摄入"><a class="anchor" href="#实时数据摄入">#</a> 实时数据摄入</h2><h3 id="概述"><a class="anchor" href="#概述">#</a> 概述</h3><blockquote><p>实时输入摄入：包括 Pull,Push 两种</p></blockquote><ul><li>Pull: 需要启动一个 RealtimeNode 节点，通过不同的 Firehose 摄取不同种类的数据源。</li><li>Push: 需要启动 Tranquility 或是 Kafka 索引服务。通过 HTTP 调用的方式进行数据摄入</li></ul><h3 id="pull"><a class="anchor" href="#pull">#</a> Pull</h3><blockquote><p>由于 Realtime Node 没有提供高可用，可伸缩等特性，对于比较重要的场景推荐使用 Tranquility Server or 或是 Tranquility Kafka 索引服务</p></blockquote><h3 id="push"><a class="anchor" href="#push">#</a> Push</h3><blockquote><p>通过 Tranquility 的数据摄入，可以分为两种方式</p></blockquote><h4 id="tranquility-serve"><a class="anchor" href="#tranquility-serve">#</a> Tranquility Serve</h4><blockquote><p>Tranquility Server：发送方可以通过 Tranquility Server 提供的 HTTP 接口，向 Druid 发送数据。</p></blockquote><p><strong>1、下载</strong> <span class="exturl" data-url="aHR0cDovL3N0YXRpYy5kcnVpZC5pby90cmFucXVpbGl0eS9yZWxlYXNlcy90cmFucXVpbGl0eS1kaXN0cmlidXRpb24tMC44LjAudGd6">Tranquility</span></p><p><strong>2、 解压</strong> <em>tar -xzf tranquility-distribution-0.8.0.tgz</em></p><p><strong>3、 复制</strong> sever <em>cp druid/conf-quickstart/tranquility/server.json server.json</em></p><p><em><strong>server.json</strong></em></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"dataSources"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"metrics"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token property">"spec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"dataSchema"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>          <span class="token property">"dataSource"</span> <span class="token operator">:</span> <span class="token string">"metrics"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>          <span class="token property">"parser"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token property">"parseSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>              <span class="token property">"timestampSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token property">"column"</span> <span class="token operator">:</span> <span class="token string">"timestamp"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token property">"format"</span> <span class="token operator">:</span> <span class="token string">"auto"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>              <span class="token property">"dimensionsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token property">"dimensions"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token property">"dimensionExclusions"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                  <span class="token string">"timestamp"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                  <span class="token string">"value"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>              <span class="token property">"format"</span> <span class="token operator">:</span> <span class="token string">"json"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>          <span class="token property">"granularitySpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"uniform"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token property">"segmentGranularity"</span> <span class="token operator">:</span> <span class="token string">"hour"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token property">"queryGranularity"</span> <span class="token operator">:</span> <span class="token string">"none"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>          <span class="token property">"metricsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"count"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>              <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"count"</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>              <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"value_sum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"doubleSum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>              <span class="token property">"fieldName"</span> <span class="token operator">:</span> <span class="token string">"value"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>              <span class="token property">"fieldName"</span> <span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>              <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"value_min"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"doubleMin"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"doubleMax"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>              <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"value_max"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>              <span class="token property">"fieldName"</span> <span class="token operator">:</span> <span class="token string">"value"</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>          <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token property">"ioConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"realtime"</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token property">"tuningConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"realtime"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>          <span class="token property">"maxRowsInMemory"</span> <span class="token operator">:</span> <span class="token string">"100000"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="57"></td><td><pre>          <span class="token property">"intermediatePersistPeriod"</span> <span class="token operator">:</span> <span class="token string">"PT10M"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="58"></td><td><pre>          <span class="token property">"windowPeriod"</span> <span class="token operator">:</span> <span class="token string">"PT10M"</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="61"></td><td><pre>      <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token property">"task.partitions"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token property">"task.replicants"</span> <span class="token operator">:</span> <span class="token string">"1"</span></pre></td></tr><tr><td data-num="64"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="67"></td><td><pre>  <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token property">"zookeeper.connect"</span> <span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token property">"druid.discovery.curator.path"</span> <span class="token operator">:</span> <span class="token string">"/druid/discovery"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token property">"druid.selectors.indexing.serviceName"</span> <span class="token operator">:</span> <span class="token string">"druid/overlord"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token property">"http.port"</span> <span class="token operator">:</span> <span class="token string">"8200"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token property">"http.threads"</span> <span class="token operator">:</span> <span class="token string">"9"</span></pre></td></tr><tr><td data-num="73"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>4、后台启动</strong></p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">nohup</span> bin/tranquility server  -configFile server.json <span class="token operator">></span>start.log <span class="token operator">&amp;</span></pre></td></tr></table></figure><p><strong>访问 Overlord Console (<span class="exturl" data-url="aHR0cDovL2hkcC1tLTEuZGF0YS5kYy56amZ0LmNvbTo4MDkwLw==">http://hdp-m-1.data.dc.zjft.com:8090/</span>)</strong></p><p><img data-src="https://upload.cc/i1/2020/01/13/UhRdK3.png" alt="img"></p><p><strong>5、发送数据</strong></p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>druid/bin//generate-example-metrics <span class="token operator">|</span> <span class="token function">curl</span> -XPOST -H<span class="token string">'Content-Type: application/json'</span> --data-binary @- http://hdp-m-1.data.dc.zjft.com:8200/v1/post/metrics</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">## 返回数据</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span><span class="token string">"result"</span>:<span class="token punctuation">&#123;</span><span class="token string">"received"</span>:25,<span class="token string">"sent"</span>:25<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://upload.cc/i1/2020/01/13/ZYkPpg.png" alt="img"></p><h4 id="tranquility-kafka"><a class="anchor" href="#tranquility-kafka">#</a> Tranquility Kafka</h4><blockquote><p>Tranquility Kafka：发送发可以先将数据发送到 Kafka,Tranquility Kafka 会根据配置从 Kafka 获取数据，并写到 Druid 中</p></blockquote><p><strong>kafka.json</strong></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"dataSources"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"metrics-kafka"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token property">"spec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"dataSchema"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>          <span class="token property">"dataSource"</span> <span class="token operator">:</span> <span class="token string">"metrics"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>          <span class="token property">"parser"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token property">"parseSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>              <span class="token property">"timestampSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token property">"column"</span> <span class="token operator">:</span> <span class="token string">"timestamp"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token property">"format"</span> <span class="token operator">:</span> <span class="token string">"auto"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>              <span class="token property">"dimensionsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token property">"dimensions"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token property">"dimensionExclusions"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                  <span class="token string">"timestamp"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                  <span class="token string">"value"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>              <span class="token property">"format"</span> <span class="token operator">:</span> <span class="token string">"json"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>          <span class="token property">"granularitySpec"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"uniform"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token property">"segmentGranularity"</span> <span class="token operator">:</span> <span class="token string">"hour"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token property">"queryGranularity"</span> <span class="token operator">:</span> <span class="token string">"none"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>          <span class="token property">"metricsSpec"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"count"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>              <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"count"</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>              <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"value_sum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"doubleSum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>              <span class="token property">"fieldName"</span> <span class="token operator">:</span> <span class="token string">"value"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>              <span class="token property">"fieldName"</span> <span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>              <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"value_min"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"doubleMin"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"doubleMax"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>              <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"value_max"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>              <span class="token property">"fieldName"</span> <span class="token operator">:</span> <span class="token string">"value"</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>          <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token property">"ioConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"realtime"</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token property">"tuningConfig"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"realtime"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>          <span class="token property">"maxRowsInMemory"</span> <span class="token operator">:</span> <span class="token string">"100000"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="57"></td><td><pre>          <span class="token property">"intermediatePersistPeriod"</span> <span class="token operator">:</span> <span class="token string">"PT10M"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="58"></td><td><pre>          <span class="token property">"windowPeriod"</span> <span class="token operator">:</span> <span class="token string">"PT10M"</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="61"></td><td><pre>      <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token property">"task.partitions"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token property">"task.replicants"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token property">"topicPattern"</span> <span class="token operator">:</span> <span class="token string">"metrics"</span> # 指定主题</pre></td></tr><tr><td data-num="65"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token property">"zookeeper.connect"</span> <span class="token operator">:</span> <span class="token string">"hdp-s-1.data.dc.zjft.com:6667"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token property">"druid.discovery.curator.path"</span> <span class="token operator">:</span> <span class="token string">"/druid/discovery"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token property">"druid.selectors.indexing.serviceName"</span> <span class="token operator">:</span> <span class="token string">"druid/overlord"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token property">"commit.periodMillis"</span> <span class="token operator">:</span> <span class="token string">"15000"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    <span class="token property">"consumer.numThreads"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token property">"kafka.zookeeper.connect"</span> <span class="token operator">:</span> <span class="token string">"hdp-s-1.data.dc.zjft.com:6667"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token property">"kafka.group.id"</span> <span class="token operator">:</span> <span class="token string">"tranquility-kafka"</span></pre></td></tr><tr><td data-num="76"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 复制 kafka.json</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">cp</span> druid/conf-quickstart/tranquility/server.json  kafka.json</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 运行 服务 就会自动从 kafka 读数据</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">nohup</span> bin/tranquility kafka  -configFile kafka.json  <span class="token operator">&amp;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">##</span></pre></td></tr></table></figure><p 注：时间戳列采用yyyy-mm-ddthh:mm:ssz格式，否则数据无法解析，应该可以配置，但未找到配置点=""><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"></mstyle></mrow><annotation encoding="application/x-tex">\color{red}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"></span></span></p><h3 id="kafka-indexing-service"><a class="anchor" href="#kafka-indexing-service">#</a> Kafka Indexing Service</h3><p>** 索引服务与实时节点比较: **</p><ul><li><p>在 Druid 重启时，索引服务不会丢数据，但是对于实时节点，如果重启太慢，数据超过了时间窗口以及延时窗口，这部分数据会被丢弃。</p></li><li><p>索引服务实际是在指定时间内处理数据，然后将数据积压，可以配置提交时间，到达提交时间时进行提交。</p></li><li><p>索引服务在 Druid 重启后，不会重读消费过的数据，也就是 offset 不会从 begining 开始，数据不会重叠。</p></li><li><p>索引服务出现在 tranquility 服务之后，实际是对实时节点的一个补充，但是索引服务只在 0.9.1.1 版本之后进行支持</p></li></ul><p><strong>supervisor-kafka-pageviews.json</strong></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"kafka"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     <span class="token property">"dataSchema"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>         <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"pageviews-kafka4"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>         <span class="token property">"parser"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>             <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>             <span class="token property">"parseSpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                 <span class="token property">"timestampSpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                     <span class="token property">"column"</span><span class="token operator">:</span> <span class="token string">"time"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                     <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"auto"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                 <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                 <span class="token property">"dimensionsSpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                     <span class="token property">"dimensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre> 		     <span class="token property">"dimensionExclusions"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                       <span class="token string">"time"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                       <span class="token string">"latencyMs"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                      <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                 <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		</pre></td></tr><tr><td data-num="20"></td><td><pre>                 <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"json"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>             <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>         <span class="token property">"granularitySpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>             <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"uniform"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>             <span class="token property">"segmentGranularity"</span><span class="token operator">:</span> <span class="token string">"hour"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>             <span class="token property">"queryGranularity"</span><span class="token operator">:</span> <span class="token string">"none"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>         <span class="token property">"metricsSpec"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                 <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"count"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                 <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"views"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>             <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>             <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                 <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"latencyMs"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                 <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"doubleSum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                 <span class="token property">"fieldName"</span><span class="token operator">:</span> <span class="token string">"latencyMs"</span></pre></td></tr><tr><td data-num="36"></td><td><pre>             <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>         <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="38"></td><td><pre>     <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>     <span class="token property">"ioConfig"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>         <span class="token property">"topic"</span><span class="token operator">:</span> <span class="token string">"pageviews1"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="41"></td><td><pre>         <span class="token property">"consumerProperties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>             <span class="token property">"bootstrap.servers"</span><span class="token operator">:</span> <span class="token string">"hdp-s-1.data.dc.zjft.com:6667,hdp-s-2.data.dc.zjft.com:6667,hdp-s-3.data.dc.zjft.com:6667"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>             <span class="token property">"group.id"</span><span class="token operator">:</span> <span class="token string">"pageviews-indexing-service"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	 <span class="token property">"useEarliestOffset"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>         <span class="token property">"taskCount"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>         <span class="token property">"replicas"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>         <span class="token property">"taskDuration"</span><span class="token operator">:</span> <span class="token string">"PT1H"</span></pre></td></tr><tr><td data-num="49"></td><td><pre>     <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>     <span class="token property">"tuningConfig"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>         <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"kafka"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="52"></td><td><pre>         <span class="token property">"maxRowsInMemory"</span><span class="token operator">:</span> <span class="token string">"100000"</span></pre></td></tr><tr><td data-num="53"></td><td><pre>     <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>运行</strong></p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> -X POST -H <span class="token string">'Content-Type: application/json'</span> -d @supervisor-kafka-pageviews.json hdp-m-2.data.dc.zjft.com:8090/druid/indexer/v1/supervisor</pre></td></tr></table></figure><p><strong>访问 Overlord Console (<span class="exturl" data-url="aHR0cDovL2hkcC1tLTEuZGF0YS5kYy56amZ0LmNvbTo4MDkwLw==">http://hdp-m-1.data.dc.zjft.com:8090/</span>)</strong></p><p><img data-src="https://upload.cc/i1/2020/01/13/Gm4Tj8.png" alt="img"></p><p><strong>点击 starus 查看 状态</strong></p><p><img data-src="https://upload.cc/i1/2020/01/13/oREi5x.png" alt="img"></p><p><strong>向 Kafka 发送几条数据</strong></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span><span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">"2020-01-13T10:07:04Z"</span><span class="token punctuation">,</span> <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"/foo/fa/info"</span><span class="token punctuation">,</span> <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"luzp"</span><span class="token punctuation">,</span> <span class="token property">"latencyMs"</span><span class="token operator">:</span> <span class="token string">"70"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span><span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">"2020-01-12T10:06:04Z"</span><span class="token punctuation">,</span> <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"/foo/bar/info"</span><span class="token punctuation">,</span> <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"xzy"</span><span class="token punctuation">,</span> <span class="token property">"latencyMs"</span><span class="token operator">:</span> <span class="token string">"80"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span><span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">"2020-01-12T10:05:04Z"</span><span class="token punctuation">,</span> <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"/foo/bar/user"</span><span class="token punctuation">,</span> <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"wwj"</span><span class="token punctuation">,</span> <span class="token property">"latencyMs"</span><span class="token operator">:</span> <span class="token string">"160"</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>消费者偏移量 将发生改变</strong></p><p><img data-src="https://upload.cc/i1/2020/01/13/MOZHSs.png" alt="img"></p><p><strong>通过 superset 查询</strong></p><p><img data-src="https://upload.cc/i1/2020/01/13/Y8isoI.png" alt="image"></p><p><strong>访问 druid 首页（<span class="exturl" data-url="aHR0cDovL2hkcC1tLTIuZGF0YS5kYy56amZ0LmNvbTo4MDgxLyVFRiVCQyU4OSVFNSU4RiVBRiVFNCVCQiVBNSVFNiU5RiVBNSVFNyU5QyU4QnNlZ21lbnQ=">http://hdp-m-2.data.dc.zjft.com:8081/）可以查看 segment</span> 粒度为小时</strong></p><p><img data-src="https://upload.cc/i1/2020/01/13/GUNVwY.png" alt="img"></p><h1 id="查询"><a class="anchor" href="#查询">#</a> 查询</h1><h2 id="查询方式"><a class="anchor" href="#查询方式">#</a> 查询方式</h2><blockquote><p>​ 使用 HTTP REST 样式请求对可查询节点（<span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL2Rlc2lnbi9icm9rZXIuaHRtbA==">Broker</span>， <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL2Rlc2lnbi9oaXN0b3JpY2FsLmh0bWw=">Historical</span> 或<span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL2Rlc2lnbi9yZWFsdGltZS5odG1s"> Realtime</span>）进行查询。该查询以 JSON 表示，并且这些节点类型中的每一个都公开相同的 REST 查询接口</p></blockquote><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> -X POST <span class="token string">'hdp-m-2.data.dc.zjft.com:8082>/druid/v2/?pretty'</span> -H <span class="token string">'Content-Type:application/json'</span> -d @<span class="token operator">&lt;</span>query_json_file<span class="token operator">></span></pre></td></tr></table></figure><p><strong>可用查询</strong></p><p>​ 对于各种用例，Druid 具有许多查询类型。查询由各种 JSON 属性组成，Druid 针对不同用例具有不同类型的查询。各种查询类型的文档描述了所有可以设置的 JSON 属性。</p><h2 id="常用查询组件"><a class="anchor" href="#常用查询组件">#</a> 常用查询组件</h2><h3 id="components"><a class="anchor" href="#components">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3R1dG9yaWFscy90dXRvcmlhbC1iYXRjaC5odG1s">Components</span></h3><h4 id="datasource"><a class="anchor" href="#datasource">#</a> Datasource</h4><ul><li><strong>datasource</strong>：</li></ul><blockquote><p>一个数据源等价于 druid 表。此外，一个查询也可以作为数据源，提供类似于子查询的功能。查询数据源目前只支持 GroupBy 查询</p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"scan"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property">"resultFormat"</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token string">"1901-01-01T00:00:00+00:00/2101-01-01T00:00:00+00:00"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token property">"columns"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token string">"countryName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token string">"cityName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token string">"countryIsoCode"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li><strong>Union Data Source</strong></li></ul><blockquote><p>联合数据源中的数据源必须拥有相同的 schema。联合查询只能被发送给 broker/router 节点，不支持直接发送到历史节点</p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"union"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token property">"dataSources"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;string_value1>"</span><span class="token punctuation">,</span> <span class="token string">"&lt;string_value2>"</span><span class="token punctuation">,</span> <span class="token string">"&lt;string_value3>"</span><span class="token punctuation">,</span> ... <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li><strong>查询</strong></li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> -XPOST -H<span class="token string">'Content-Type: application/json'</span> http://hdp-m-2.data.dc.zjft.com:8082/druid/v2/?pretty -d @query.json</pre></td></tr></table></figure><p><em><strong>返回结果</strong></em></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"segmentId"</span> <span class="token operator">:</span> <span class="token string">"wikiticker_2015-09-12T00:00:00.000Z_2015-09-13T00:00:00.000Z_2020-01-07T01:42:03.953Z"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"columns"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token string">"countryName"</span><span class="token punctuation">,</span> <span class="token string">"cityName"</span><span class="token punctuation">,</span> <span class="token string">"countryIsoCode"</span><span class="token punctuation">,</span> <span class="token string">"count"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"events"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"page"</span> <span class="token operator">:</span> <span class="token string">"Talk:Oswald Tilghman"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"countryName"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"cityName"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token property">"countryIsoCode"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token property">"count"</span> <span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token property">"page"</span> <span class="token operator">:</span> <span class="token string">"Rallicula"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"countryName"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token property">"cityName"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token property">"countryIsoCode"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token property">"count"</span> <span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token property">"page"</span> <span class="token operator">:</span> <span class="token string">"Peremptory norm"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token property">"countryName"</span> <span class="token operator">:</span> <span class="token string">"Australia"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token property">"cityName"</span> <span class="token operator">:</span> <span class="token string">"Auburn"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token property">"countryIsoCode"</span> <span class="token operator">:</span> <span class="token string">"AU"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token property">"count"</span> <span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token property">"page"</span> <span class="token operator">:</span> <span class="token string">"Apamea abruzzorum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token property">"countryName"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token property">"cityName"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token property">"countryIsoCode"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token property">"count"</span> <span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token property">"page"</span> <span class="token operator">:</span> <span class="token string">"Atractus flammigerus"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token property">"countryName"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token property">"cityName"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token property">"countryIsoCode"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token property">"count"</span> <span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token punctuation">]</span></pre></td></tr></table></figure><h4 id="filters"><a class="anchor" href="#filters">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3F1ZXJ5aW5nL2ZpbHRlcnMuaHRtbA==">Filters</span></h4><ul><li><p><strong>Selector filter</strong></p><blockquote><p>等价于 sql 的 `where countryIsoCode = 'US'</p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"scan"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"selector"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"countryIsoCode"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"US"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token property">"resultFormat"</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token property">"columns"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token string">"countryName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token string">"cityName"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token string">"1901-01-01T00:00:00+00:00/2101-01-01T00:00:00+00:00"</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>Column Comparison filter</strong></p><blockquote><p>等价于 sql 的 <code>where countryName = cityName</code></p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"scan"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"columnComparison"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token property">"dimensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token string">"countryName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token string">"cityName"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token property">"resultFormat"</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token property">"columns"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token string">"countryName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token string">"cityName"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="21"></td><td><pre>     <span class="token string">"1901-01-01T00:00:00+00:00/2101-01-01T00:00:00+00:00"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>Regular expression filter</strong></p><blockquote><p>正则表达式，支持标准的 java 正则表达式，下面的查询表示 countryIsoCode 以 U 开头</p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"scan"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"regex"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"countryIsoCode"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"pattern"</span><span class="token operator">:</span> <span class="token string">"^U"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token property">"resultFormat"</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token property">"columns"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token string">"countryName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token string">"cityName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token string">"countryIsoCode"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="20"></td><td><pre>     <span class="token string">"1901-01-01T00:00:00+00:00/2101-01-01T00:00:00+00:00"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>Logical expression filters</strong></p><blockquote><p>支持 and or not，下面的等价于 <code>where countryIsoCode = 'US' and cityName = 'New York'</code></p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"scan"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"and"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="10"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"selector"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"countryIsoCode"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"US"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"selector"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"cityName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"New York"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token property">"resultFormat"</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token property">"columns"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token string">"countryName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token string">"cityName"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token string">"countryIsoCode"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="30"></td><td><pre>       <span class="token string">"1901-01-01T00:00:00+00:00/2101-01-01T00:00:00+00:00"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>JavaScript filter</strong></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"javascript"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token property">"dimension"</span> <span class="token operator">:</span> <span class="token string">"countryIsoCode"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token property">"function"</span> <span class="token operator">:</span> <span class="token string">"function(value) &#123; return (value == 'US' || value == 'CN') &#125;"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>Search filter</strong></p><blockquote><p>用于部分字符串匹配，如下面的表示包含 foo，并且对大小写不敏感</p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"search"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"product"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"insensitive_contains"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"foo"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>In filter</strong></p><blockquote><p>等价于 <code>where countryIsoCode in ('US', 'CN')</code></p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"in"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"dimension"</span> <span class="token operator">:</span> <span class="token string">"countryIsoCode"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"values"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"US"</span><span class="token punctuation">,</span> <span class="token string">"CN"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>Like filter</strong></p><blockquote><p>等价于 <code>where countryIsoCode like '%U'</code></p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"like"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"dimension"</span> <span class="token operator">:</span> <span class="token string">"countryIsoCode"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"pattern"</span><span class="token operator">:</span> <span class="token string">"%U"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>Bourd filter</strong></p><blockquote><p>等价于 <code>&quot;CN&quot; &lt; countryIsoCode &lt; &quot;US&quot;</code></p></blockquote><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"bound"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"dimension"</span> <span class="token operator">:</span> <span class="token string">"countryIsoCode"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"lower"</span><span class="token operator">:</span> <span class="token string">"CN"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"lowerStrict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"upper"</span><span class="token operator">:</span> <span class="token string">"US"</span> <span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"ordering"</span><span class="token operator">:</span> <span class="token string">"numeric"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token property">"upperStrict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token property">"ordering"</span><span class="token operator">:</span> <span class="token string">"lexicographic"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ul><h4 id="aggregations"><a class="anchor" href="#aggregations">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3F1ZXJ5aW5nL2FnZ3JlZ2F0aW9ucy5odG1s">Aggregations</span></h4><ul><li><p><strong>Count aggregator</strong></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  page<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> num</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> wikiticker</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">where</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-28 00:00:00'</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">group</span> <span class="token keyword">by</span> page</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">order</span> <span class="token keyword">by</span> num <span class="token keyword">desc</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">limit</span> <span class="token number">5</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"topN"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"threshold"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token property">"metric"</span><span class="token operator">:</span> <span class="token string">"num"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property">"granularity"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"count"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"num"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token string">"2016-06-27/2016-06-28"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>Sum aggregator</strong></p><blockquote><p>longSum、doubleSum、floatSum</p></blockquote><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    page<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">sum</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span> <span class="token keyword">as</span> num</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> wikiticker</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">where</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-28 00:00:00'</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">group</span> <span class="token keyword">by</span> page</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">order</span> <span class="token keyword">by</span> page <span class="token keyword">asc</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">limit</span> <span class="token number">5</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"topN"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"threshold"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token property">"metric"</span><span class="token operator">:</span> <span class="token string">"num"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property">"granularity"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"longSum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"num"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token property">"fieldName"</span> <span class="token operator">:</span> <span class="token string">"delta"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token string">"2016-06-27/2016-06-28"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong>Min / Max aggregators</strong></p><blockquote><p>doubleMin、doubleMax、floatMin、floatMax、longMin、longMax</p></blockquote><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    page<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">max</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span> <span class="token keyword">as</span> num</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> wikiticker</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">where</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-28 00:00:00'</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">group</span> <span class="token keyword">by</span> page</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">order</span> <span class="token keyword">by</span> page <span class="token keyword">asc</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">limit</span> <span class="token number">5</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"topN"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"threshold"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token property">"metric"</span><span class="token operator">:</span> <span class="token string">"num"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property">"granularity"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"longMax"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"num"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token property">"fieldName"</span> <span class="token operator">:</span> <span class="token string">"delta"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token string">"2016-06-27/2016-06-28"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><strong><span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMS4wL3F1ZXJ5aW5nL2FnZ3JlZ2F0aW9ucy5odG1sP3NwbT1hMmM0Zy4xMTE4NjYyMy4yLjExLjNiMzA0NWE3M3F3NjVT">更多聚合</span></strong></p></li></ul><h3 id="timeseries"><a class="anchor" href="#timeseries">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3F1ZXJ5aW5nL3RpbWVzZXJpZXNxdWVyeS5odG1s">Timeseries</span></h3><blockquote><p>统计一段时间内的汇总数据</p></blockquote><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> num<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sum</span><span class="token punctuation">(</span>added<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">FROM</span> wikiticker</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">WHERE</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 23:59:59'</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"timeseries"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"granularity"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"count"</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"count"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"longSum"</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"added"</span><span class="token punctuation">,</span> <span class="token property">"fieldName"</span><span class="token operator">:</span> <span class="token string">"added"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"2016-06-27/2016-06-28"</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="topn"><a class="anchor" href="#topn">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3F1ZXJ5aW5nL3RvcG5xdWVyeS5odG1s">TopN</span></h3><blockquote><p>返回前 N 条数据，并可以按照 metric 排序，可以支持维度，但只有一个</p></blockquote><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    page<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">sum</span><span class="token punctuation">(</span>added<span class="token punctuation">)</span> <span class="token keyword">as</span> num</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">FROM</span> wikiticker</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">WHERE</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 23:59:59'</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">group</span> <span class="token keyword">by</span> page</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">order</span> <span class="token keyword">by</span> num <span class="token keyword">desc</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">limit</span> <span class="token number">5</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"topN"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"threshold"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token property">"metric"</span><span class="token operator">:</span> <span class="token string">"added"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property">"granularity"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"doubleSum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"added"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token property">"fieldName"</span><span class="token operator">:</span> <span class="token string">"added"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"2016-06-27/2016-06-28"</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="groupby"><a class="anchor" href="#groupby">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3F1ZXJ5aW5nL2dyb3VwYnlxdWVyeS5odG1s">GroupBy</span></h3><blockquote><p>能对指定的多个维度分组，也支持对指定的维度排序，也支持 limit，但是性能比 TopN 和 Timeseries 要差很多</p></blockquote><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    page<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    countryName<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">sum</span><span class="token punctuation">(</span>added<span class="token punctuation">)</span> <span class="token keyword">as</span> num<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">sum</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span> <span class="token keyword">as</span> num2</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">FROM</span> wikiticker</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">WHERE</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 23:59:59'</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">group</span> <span class="token keyword">by</span> page<span class="token punctuation">,</span>countryName</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">order</span> <span class="token keyword">by</span> num <span class="token keyword">desc</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">limit</span> <span class="token number">5</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"groupBy"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikiticker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"granularity"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"dimensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">"countryName"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token property">"limitSpec"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"columns"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token property">"dimension"</span><span class="token operator">:</span> <span class="token string">"added"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"direction"</span><span class="token operator">:</span> <span class="token string">"descending"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"dimensionOrder"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"numeric"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"longSum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"added"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token property">"fieldName"</span><span class="token operator">:</span> <span class="token string">"added"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"longSum"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"delta"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token property">"fieldName"</span><span class="token operator">:</span> <span class="token string">"delta"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token string">"2016-06-27/2016-06-28"</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="search"><a class="anchor" href="#search">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3F1ZXJ5aW5nL3NlYXJjaHF1ZXJ5Lmh0bWw=">Search</span></h3><blockquote><p>类似于 like 操作，可以查询多个维度列，不支持聚合</p></blockquote><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	page<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	countryName</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">FROM</span> wikipedia</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">WHERE</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 23:59:59'</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">and</span> page <span class="token operator">like</span> <span class="token string">'%C'</span> <span class="token operator">or</span> countryName <span class="token operator">like</span> <span class="token string">'%C'</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">limit</span> <span class="token number">5</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"search"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikipedia3"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"granularity"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"dimensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string">"page"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">"countryName"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"insensitive_contains"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"C"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"lexicographic"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token string">"2016-06-27/2016-06-28"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="select"><a class="anchor" href="#select">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3F1ZXJ5aW5nL3NlbGVjdC1xdWVyeS5odG1s">Select</span></h3><blockquote><p>查数据，不支持聚合，但支持分页，排序</p></blockquote><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">FROM</span> wikipedia</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">WHERE</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 23:59:59'</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"select"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikipedia3"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"granularity"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"dimensions"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token property">"metrics"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property">"pagingSpec"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"pagingIdentifiers"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token property">"threshold"</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token string">"2016-06-27/2016-06-28"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="scan"><a class="anchor" href="#scan">#</a> <span class="exturl" data-url="aHR0cDovL2RydWlkLmlvL2RvY3MvMC4xMi4xL3F1ZXJ5aW5nL3NjYW4tcXVlcnkuaHRtbA==">Scan</span></h3><blockquote><p>类似于 Select，但不支持分页，但是如果没有分页需求，推荐使用这个，性能比 Select 好</p></blockquote><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num="2"></td><td><pre>page<span class="token punctuation">,</span>countryName</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">FROM</span> wikipedia</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">WHERE</span> <span class="token string">"__time"</span> <span class="token operator">BETWEEN</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 00:00:00'</span> <span class="token operator">AND</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'2016-06-27 23:59:59'</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">limit</span> <span class="token number">5</span></pre></td></tr></table></figure><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token property">"queryType"</span><span class="token operator">:</span> <span class="token string">"scan"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token property">"dataSource"</span><span class="token operator">:</span> <span class="token string">"wikipedia3"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token property">"resultFormat"</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token property">"columns"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"page"</span><span class="token punctuation">,</span><span class="token string">"countryName"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token property">"intervals"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="7"></td><td><pre>     <span class="token string">"2016-06-27/2016-06-28"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token property">"batchSize"</span><span class="token operator">:</span><span class="token number">20480</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   <span class="token property">"limit"</span><span class="token operator">:</span><span class="token number">5</span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="支持sql查询"><a class="anchor" href="#支持sql查询">#</a> 支持 SQL 查询</h1><blockquote><p>Apache Druid（孵化）SQL 是一个内置的 SQL 层，是 Druid 原生的基于 JSON 的查询语言的替代品，由基于<span class="exturl" data-url="aHR0cHM6Ly9jYWxjaXRlLmFwYWNoZS5vcmcv"> Apache Calcite</span> 的解析器和规划器提供支持。Druid SQL 将 SQL 转换为查询 Broker（您查询的第一个进程）上的本机 Druid 查询，然后将其作为本机 Druid 查询传递给数据进程。除了在 Broker 上转换 SQL 的（轻微）开销之外，与本机查询相比，没有额外的性能损失。</p></blockquote><p>请确保已 <code>druid.sql.enable = true</code> 在 common.runtime.properties 或 Broker 的 runtime.properties 中设置。</p><p><img data-src="https://upload.cc/i1/2020/01/13/Q6UuDX.png" alt="img"></p><p 注：使用kafka="" indexing="" service="" 导入数据无法使用sql查询=""><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"></mstyle></mrow><annotation encoding="application/x-tex">\color{red}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"></span></span></p><p><em><strong>pageviews_count_sql.json</strong></em></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span><span class="token property">"query"</span><span class="token operator">:</span><span class="token string">"SELECT url,latencyMs  FROM pageviews"</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/druid/" rel="tag"><i class="ic i-tag"></i> druid</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-04-23 16:48:57" itemprop="dateModified" datetime="2021-04-23T16:48:57+08:00">2021-04-23</time> </span><span id="Druid-基本概念与使用/" class="item leancloud_visitors" data-flag-title="Druid-基本概念与使用" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Lucas 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Lucas 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Lucas 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Lucas <i class="ic i-at"><em>@</em></i>专注技术分享</li><li class="link"><strong>本文链接：</strong> <a href="http://yrmlnf.coding-pages.com/Druid-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E4%BD%BF%E7%94%A8/" title="Druid-基本概念与使用">http://yrmlnf.coding-pages.com/Druid-基本概念与使用/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Maxwell-%E6%95%B4%E5%90%88kafka%E4%B8%8Ebireme/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;005yAHGDly8gplguyta0ij31hc0u07d4.jpg" title="Maxwell-整合kafka与bireme"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 大数据</span><h3>Maxwell-整合kafka与bireme</h3></a></div><div class="item right"><a href="/Pentaho-8-3%E7%89%88%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;005yAHGDly8gplfdxvrazj31hc0u07cc.jpg" title="Pentaho-8.3版本数据库迁移"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 数据可视化</span><h3>Pentaho-8.3版本数据库迁移</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFdruid"><span class="toc-number">1.</span> <span class="toc-text">什么是 DRUID</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#druid%E7%9A%84%E6%8A%80%E6%9C%AF%E7%89%B9%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">Druid 的技术特点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#druid%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">Druid 总体架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#historical%E5%8E%86%E5%8F%B2%E8%8A%82%E7%82%B9"><span class="toc-number">3.1.</span> <span class="toc-text">Historical（历史节点)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#realtime-%E5%AE%9E%E6%97%B6%E8%8A%82%E7%82%B9"><span class="toc-number">3.2.</span> <span class="toc-text">Realtime （实时节点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#segment%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%88%B6%E9%80%A0%E4%B8%8E%E4%BC%A0%E6%92%AD"><span class="toc-number">3.2.1.</span> <span class="toc-text">Segment 数据文件的制造与传播</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#coordinator-%E5%8D%8F%E8%B0%83%E8%8A%82%E7%82%B9"><span class="toc-number">3.3.</span> <span class="toc-text">Coordinator (协调节点)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#broker-%E6%9F%A5%E8%AF%A2%E8%8A%82%E7%82%B9"><span class="toc-number">3.4.</span> <span class="toc-text">Broker （查询节点）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#indexer-%E7%B4%A2%E5%BC%95%E8%8A%82%E7%82%B9"><span class="toc-number">3.5.</span> <span class="toc-text">Indexer（ 索引节点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#middlemanager"><span class="toc-number">3.5.1.</span> <span class="toc-text">MiddleManager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#overlord"><span class="toc-number">3.5.2.</span> <span class="toc-text">Overlord</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#router%E5%8F%AF%E9%80%89"><span class="toc-number">3.6.</span> <span class="toc-text">Router (可选)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E4%BE%9D%E8%B5%96"><span class="toc-number">3.7.</span> <span class="toc-text">外部依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%8A%82%E7%82%B9"><span class="toc-number">3.8.</span> <span class="toc-text">安装节点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#druid%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">4.</span> <span class="toc-text">Druid 基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#datasource%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">DataSource 结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#segment%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">Segment 结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%AE%9A%E4%B9%89"><span class="toc-number">4.3.</span> <span class="toc-text">数据格式定义</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%91%84%E5%85%A5"><span class="toc-number">5.</span> <span class="toc-text">数据摄入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E6%91%84%E5%85%A5"><span class="toc-number">5.1.</span> <span class="toc-text">批处理数据摄入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%91%84%E5%85%A5"><span class="toc-number">5.1.1.</span> <span class="toc-text">本地文件摄入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hadoop-%E6%96%87%E4%BB%B6%E6%91%84%E5%85%A5"><span class="toc-number">5.1.2.</span> <span class="toc-text">hadoop 文件摄入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#csv%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5"><span class="toc-number">5.1.3.</span> <span class="toc-text">CSV 文件导入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E6%91%84%E5%85%A5"><span class="toc-number">5.2.</span> <span class="toc-text">实时数据摄入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">5.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pull"><span class="toc-number">5.2.2.</span> <span class="toc-text">Pull</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#push"><span class="toc-number">5.2.3.</span> <span class="toc-text">Push</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tranquility-serve"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">Tranquility Serve</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tranquility-kafka"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">Tranquility Kafka</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kafka-indexing-service"><span class="toc-number">5.2.4.</span> <span class="toc-text">Kafka Indexing Service</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text">查询方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E7%BB%84%E4%BB%B6"><span class="toc-number">6.2.</span> <span class="toc-text">常用查询组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#components"><span class="toc-number">6.2.1.</span> <span class="toc-text">Components</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#datasource"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">Datasource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filters"><span class="toc-number">6.2.1.2.</span> <span class="toc-text">Filters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#aggregations"><span class="toc-number">6.2.1.3.</span> <span class="toc-text">Aggregations</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#timeseries"><span class="toc-number">6.2.2.</span> <span class="toc-text">Timeseries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#topn"><span class="toc-number">6.2.3.</span> <span class="toc-text">TopN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#groupby"><span class="toc-number">6.2.4.</span> <span class="toc-text">GroupBy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#search"><span class="toc-number">6.2.5.</span> <span class="toc-text">Search</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select"><span class="toc-number">6.2.6.</span> <span class="toc-text">Select</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scan"><span class="toc-number">6.2.7.</span> <span class="toc-text">Scan</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%AF%E6%8C%81sql%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.</span> <span class="toc-text">支持 SQL 查询</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Pentaho-%E5%88%9D%E8%AF%86%E5%BC%80%E6%BA%90%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0/" rel="bookmark" title="Pentaho-初识开源大数据平台">Pentaho-初识开源大数据平台</a></li><li><a href="/Superset-%E8%BD%BB%E9%87%8F%E7%BA%A7BI%E5%B9%B3%E5%8F%B0%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="bookmark" title="Superset-轻量级BI平台的使用">Superset-轻量级BI平台的使用</a></li><li><a href="/Pentaho-%E6%97%B6%E9%97%B4%E7%BB%B4%E5%BA%A6%E8%A1%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" rel="bookmark" title="Pentaho-时间维度表最佳实践">Pentaho-时间维度表最佳实践</a></li><li><a href="/Pentaho-%E7%BC%93%E6%85%A2%E5%A2%9E%E9%95%BF%E7%BB%B4%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" rel="bookmark" title="Pentaho-缓慢增长维最佳实践">Pentaho-缓慢增长维最佳实践</a></li><li><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93-%E4%B8%80%E4%BA%9B%E6%95%B0%E4%BB%93%E7%90%86%E8%AE%BA%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84%E7%90%86%E8%A7%A3/" rel="bookmark" title="数据仓库-一些数仓理论在工作中的理解">数据仓库-一些数仓理论在工作中的理解</a></li><li><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Pentaho-CDE%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/" rel="bookmark" title="Pentaho-CDE开发指南">Pentaho-CDE开发指南</a></li><li><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/Solr-%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BD%BF%E7%94%A8/" rel="bookmark" title="Solr-全文搜索引擎使用">Solr-全文搜索引擎使用</a></li><li><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Superset-%E5%9B%BE%E8%A1%A8%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B/" rel="bookmark" title="Superset-图表渲染流程">Superset-图表渲染流程</a></li><li><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Superset-%E9%9B%86%E6%88%90Echarts%E9%A5%BC%E5%9B%BE/" rel="bookmark" title="Superset-集成Echarts饼图">Superset-集成Echarts饼图</a></li><li><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Superset-%E9%9B%86%E6%88%90Echarts%E5%9C%B0%E5%9B%BE/" rel="bookmark" title="Superset-集成Echarts地图">Superset-集成Echarts地图</a></li><li><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86/%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86-%E6%95%B0%E6%8D%AE%E8%A1%80%E7%BC%98%E8%AE%BE%E8%AE%A1/" rel="bookmark" title="数据治理-数据血缘设计">数据治理-数据血缘设计</a></li><li><a href="/Maxwell-%E6%95%B4%E5%90%88kafka%E4%B8%8Ebireme/" rel="bookmark" title="Maxwell-整合kafka与bireme">Maxwell-整合kafka与bireme</a></li><li class="active"><a href="/Druid-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E4%BD%BF%E7%94%A8/" rel="bookmark" title="Druid-基本概念与使用">Druid-基本概念与使用</a></li><li><a href="/Pentaho-8-3%E7%89%88%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB/" rel="bookmark" title="Pentaho-8.3版本数据库迁移">Pentaho-8.3版本数据库迁移</a></li><li><a href="/Pentaho-RestAPI%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" rel="bookmark" title="Pentaho-RestAPI用户角色权限管理">Pentaho-RestAPI用户角色权限管理</a></li><li><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Superset-%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/" rel="bookmark" title="Superset-二次开发指南">Superset-二次开发指南</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Lucas" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Lucas</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">40</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">12</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">41</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Maxwell-%E6%95%B4%E5%90%88kafka%E4%B8%8Ebireme/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Pentaho-8-3%E7%89%88%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/" title="分类于 大数据">大数据</a></div><span><a href="/Maxwell-%E6%95%B4%E5%90%88kafka%E4%B8%8Ebireme/" title="Maxwell-整合kafka与bireme">Maxwell-整合kafka与bireme</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="分类于 数据库">数据库</a></div><span><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="Redis-基本概念与解决方案">Redis-基本概念与解决方案</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/IT%E8%BF%90%E7%BB%B4/" title="分类于 IT运维">IT运维</a></div><span><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/IT%E8%BF%90%E7%BB%B4/NodeJs-%E5%9C%A8%E5%90%84%E7%B3%BB%E7%BB%9F%E4%B8%8B%E5%AE%89%E8%A3%85/" title="Nodejs-在各系统安装">Nodejs-在各系统安装</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/IT%E8%BF%90%E7%BB%B4/" title="分类于 IT运维">IT运维</a></div><span><a href="/Superset-%E6%89%93%E5%8C%85%E5%88%86%E5%8F%91%E4%B8%8E%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" title="Superset-打包分发与集群部署">Superset-打包分发与集群部署</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/" title="分类于 大数据">大数据</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" title="分类于 数据可视化">数据可视化</a></div><span><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Superset-%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/" title="Superset-二次开发指南">Superset-二次开发指南</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/" title="分类于 大数据">大数据</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" title="分类于 数据可视化">数据可视化</a></div><span><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Superset-%E9%9B%86%E6%88%90Echarts%E5%9C%B0%E5%9B%BE/" title="Superset-集成Echarts地图">Superset-集成Echarts地图</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%BD%AF%E4%BB%B6%E5%BA%94%E7%94%A8/" title="分类于 软件应用">软件应用</a></div><span><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%BD%AF%E4%BB%B6%E5%BA%94%E7%94%A8/Hexo-Next7%E4%B8%BB%E9%A2%98%E4%BC%98%E5%8C%96/" title="Hexo-Next7主题优化">Hexo-Next7主题优化</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" title="分类于 网络爬虫">网络爬虫</a></div><span><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/PySpider-%E7%88%AC%E5%8F%96Shopfiy%E5%BA%94%E7%94%A8/" title="PySpider-爬取Shopify应用">PySpider-爬取Shopify应用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%B7%A8%E5%A2%83%E7%94%B5%E5%95%86/" title="分类于 跨境电商">跨境电商</a></div><span><a href="/%E8%B7%A8%E5%A2%83%E7%94%B5%E5%95%86/Amazon-2020%E5%BC%80%E5%BA%97%E6%88%90%E6%9C%AC/" title="Amazon-2020开店成本">Amazon-2020开店成本</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="分类于 数据库">数据库</a></div><span><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E4%BC%98%E5%8C%96/" title="MySQL-基本概念与优化">MySQL-基本概念与优化</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Lucas @ Lucas Home</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">370k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">5:36</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Druid-基本概念与使用/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->